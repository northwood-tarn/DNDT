<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pixi Prototype – Architectural Engine</title>
  <link rel="stylesheet" href="shell.css" />
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #101826ee;
      --border: #22314d;
      --acc: #9bb7ff;
      --text: #e6e6e6;
      --muted: #9aa9c7;
      --mono: ui-monospace, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); }
    #wrap { position: relative; width: 100%; height: 100vh; }
    #game {
      position: fixed; left: 12px; top: 12px;
      width: 608px; height: 592px;
      border:1px solid var(--border);
      background:#0a0f16;
      z-index: 1;
    }
    #panel {
      position: fixed; top: 12px; right: 12px; bottom: 12px;
      width: 460px; overflow-y: auto;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 8px;
      font: 11px/1.2 var(--mono);
      color: var(--text);
      padding: 8px 10px;
      z-index: 2;
    }
    #panel h3 { margin: 6px 0 6px 0; font: 700 11px/1 var(--mono); letter-spacing: 1px; color: var(--acc); text-transform: uppercase; display:flex; align-items:center; gap:6px; }
    .tinybtn { font: 10px/1 var(--mono); padding:2px 6px; border:1px solid var(--border); background:#0b1422; color:#cfe0ff; border-radius:4px; cursor:pointer; opacity:0.9; }
    .tinybtn:hover { opacity:1; }
    .grid { display:grid; grid-template-columns: 160px 1fr; column-gap:10px; row-gap:4px; align-items:center; }
    .grid label { color: var(--muted); white-space:nowrap; }
    .grid input[type="range"], .grid select { width: 240px; }
    .grid input[type="color"] { width: 32px; height: 20px; padding:0; border:1px solid var(--border); border-radius:4px; background:#0a0f16; }
    hr { border: none; border-top: 1px solid var(--border); margin: 8px 0; }
    .hint { color: var(--muted); opacity: .8; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="wrap">
    <div id="game"></div>
    <div id="panel">
      <h3>View</h3>
      <div class="grid">
        <label for="ctlViewMode">Mode</label>
        <select id="ctlViewMode">
          <option value="raw">Raw image</option>
          <option value="treatment" selected>Treatment only</option>
          <option value="lighting">Treatment + lighting</option>
          <option value="export">Export view</option>
        </select>
      </div>
      <hr>
      
      <h3>Regions</h3>
      <div class="grid">
        <label for="ctlRegionEnable">Enable region</label><input id="ctlRegionEnable" type="checkbox">
        <label></label>
        <div>
          <button id="btnAddRegion" class="tinybtn" title="Draw a rectangle region">Add rectangle</button>
          <button id="btnEditRegion" class="tinybtn" title="Drag region to move">Edit</button>
          <button id="btnClearRegion" class="tinybtn" title="Remove region">Clear</button>
        </div>
        <label for="ctlRegionAffectBg">Affect background</label><input id="ctlRegionAffectBg" type="checkbox" checked>
        <label for="ctlRegionAffectEdges">Affect edges</label><input id="ctlRegionAffectEdges" type="checkbox" checked>
        <label for="ctlRegionAffectOver">Affect overlays</label><input id="ctlRegionAffectOver" type="checkbox" checked>
      </div>
      <hr>

      <div id="secExport" class="grid hidden">
        <label>Export</label>
        <div>
          <button id="btnExport" class="tinybtn" title="Export current map (no lighting) as PNG">Export PNG</button>
          <span class="hint">Exports full map without lighting.</span>
        </div>

        <label for="ctlExportSize">Export size</label>
        <select id="ctlExportSize">
          <option value="scaled" selected>Scaled (preview scale)</option>
          <option value="native">Native (source 1.0×)</option>
        </select>
        <label for="ctlExportSmooth">Smoothing</label>
        <div>
          <input id="ctlExportSmooth" type="checkbox"> <span class="hint">Edge‑preserving: background only</span>
        </div>
        <label for="ctlExportSmoothAmt">Smooth strength</label>
        <input id="ctlExportSmoothAmt" type="range" min="0" max="3" step="1" value="1">
        <label for="ctlExportTarget">Smooth target</label>
        <select id="ctlExportTarget">
          <option value="bg" selected>Background only (keep edges crisp)</option>
          <option value="all">Whole image</option>
        </select>

      </div>
      <hr>

      <h3>Profiles</h3>
      <div class="grid">
        <label for="ctlProfile">Preset</label>
        <select id="ctlProfile">
          <option value="tech">Technical Pen</option>
          <option value="blueprint">Blueprint</option>
          <option value="graphite">Graphite</option>
        </select>
      </div>
      <hr>
      
      <h3>Regions</h3>
      <div class="grid">
        <label for="ctlRegionEnable">Enable region</label><input id="ctlRegionEnable" type="checkbox">
        <label></label>
        <div>
          <button id="btnAddRegion" class="tinybtn" title="Draw a rectangle region">Add rectangle</button>
          <button id="btnEditRegion" class="tinybtn" title="Drag region to move">Edit</button>
          <button id="btnClearRegion" class="tinybtn" title="Remove region">Clear</button>
        </div>
        <label for="ctlRegionAffectBg">Affect background</label><input id="ctlRegionAffectBg" type="checkbox" checked>
        <label for="ctlRegionAffectEdges">Affect edges</label><input id="ctlRegionAffectEdges" type="checkbox" checked>
        <label for="ctlRegionAffectOver">Affect overlays</label><input id="ctlRegionAffectOver" type="checkbox" checked>
      </div>
      <hr>

      <div id="secExport" class="grid hidden">
        <label>Export</label>
        <div>
          <button id="btnExport" class="tinybtn" title="Export current map (no lighting) as PNG">Export PNG</button>
          <span class="hint">Exports full map without lighting.</span>
        </div>

        <label for="ctlExportSize">Export size</label>
        <select id="ctlExportSize">
          <option value="scaled" selected>Scaled (preview scale)</option>
          <option value="native">Native (source 1.0×)</option>
        </select>
        <label for="ctlExportSmooth">Smoothing</label>
        <div>
          <input id="ctlExportSmooth" type="checkbox"> <span class="hint">Edge‑preserving: background only</span>
        </div>
        <label for="ctlExportSmoothAmt">Smooth strength</label>
        <input id="ctlExportSmoothAmt" type="range" min="0" max="3" step="1" value="1">
        <label for="ctlExportTarget">Smooth target</label>
        <select id="ctlExportTarget">
          <option value="bg" selected>Background only (keep edges crisp)</option>
          <option value="all">Whole image</option>
        </select>

      </div>
      <hr>

      <!-- Geometry pipeline -->
      <h3>Geometry Pipeline <button id="resetGeom" class="tinybtn" title="Reset geometry controls">Reset</button></h3>
      <div class="grid">
        <label for="ctlGeomSelect">Section</label>
        <select id="ctlGeomSelect">
          <option value="edge">Edge Map</option>
          <option value="snap">Rectilinear Snap</option>
          <option value="poster">Posterize & Poche</option>
        </select>
      </div>

      <div id="secEdge" class="grid">
        <label for="ctlEdgeOn">Enable</label><input id="ctlEdgeOn" type="checkbox" checked>
        <label for="ctlEdgeTh">Threshold</label><input id="ctlEdgeTh" type="range" min="0" max="255" step="1" value="40">
        <label for="ctlEdgeGain">Gain / Thickness</label><input id="ctlEdgeGain" type="range" min="1" max="6" step="0.1" value="3">
        <label for="ctlEdgeA">Edge alpha</label><input id="ctlEdgeA" type="range" min="0" max="1" step="0.01" value="1">
        <label for="ctlEdgeColor">Ink</label><input id="ctlEdgeColor" type="color" value="#111111">
      </div>

      <div id="secSnap" class="grid hidden">
        <label for="ctlSnap">Snap strength</label><input id="ctlSnap" type="range" min="0" max="1" step="0.01" value="0.7">
        <label for="ctlCorner">Corner sharpness</label><input id="ctlCorner" type="range" min="0" max="1" step="0.01" value="0.6">
        <label for="ctlOutline">Outline thickness</label><input id="ctlOutline" type="range" min="0" max="6" step="0.1" value="2.5">
        <label for="ctlInterior">Interior trim</label><input id="ctlInterior" type="range" min="0" max="3" step="0.1" value="1">
      </div>

      <div id="secPoster" class="grid hidden">
        <label for="ctlPosterLevels">Posterize levels</label><input id="ctlPosterLevels" type="range" min="2" max="6" step="1" value="3">
        <label for="ctlPocheBand">Poche band</label><input id="ctlPocheBand" type="range" min="0" max="5" step="1" value="0">
        <label for="ctlPocheOpacity">Poche opacity</label><input id="ctlPocheOpacity" type="range" min="0" max="1" step="0.01" value="0.45">
        <label for="ctlPalette">Palette</label>
        <select id="ctlPalette">
          <option value="black">Black ink / white paper</option>
          <option value="blueprint">Blueprint (navy on cyan)</option>
          <option value="graphite">Graphite (grey on warm)</option>
        </select>
      </div>

      <hr>

      <!-- Alienization packs -->
      <h3>Alienization <button id="resetAlien" class="tinybtn" title="Reset alienization">Reset</button></h3>
      <div class="grid">
        <label for="ctlAlienSelect">Pack</label>
        <select id="ctlAlienSelect">
          <option value="none">None</option>
          <option value="v1">Pack v1 (Warp/Grid/Glyphs)</option>
          <option value="v2">Pack v2 (Fracture/Guides/Marks)</option>
        </select>
      </div>

      <div id="secAlienV1" class="grid hidden">
        <label for="ctlWarpType">Warp</label>
        <select id="ctlWarpType">
          <option value="none">None</option>
          <option value="barrel">Barrel/Pincushion</option>
          <option value="swirl">Swirl</option>
        </select>
        <label for="ctlWarpAmt">Warp amount</label><input id="ctlWarpAmt" type="range" min="-1" max="1" step="0.01" value="0">
        <label for="ctlGridOn">Construction grid</label><input id="ctlGridOn" type="checkbox">
        <label for="ctlGridSpacing">Grid spacing</label><input id="ctlGridSpacing" type="range" min="16" max="256" step="4" value="64">
        <label for="ctlGridAngle">Grid angle</label><input id="ctlGridAngle" type="range" min="-90" max="90" step="1" value="0">
        <label for="ctlGlyphOn">Glyph annotations</label><input id="ctlGlyphOn" type="checkbox">
        <label for="ctlGlyphDensity">Glyph density</label><input id="ctlGlyphDensity" type="range" min="0" max="1" step="0.01" value="0.4">
        <label for="ctlGlyphSize">Glyph size</label><input id="ctlGlyphSize" type="range" min="1" max="8" step="1" value="3">
      </div>

      <div id="secAlienV2" class="grid hidden">
        <label for="ctlFracOn">Voronoi fracture</label><input id="ctlFracOn" type="checkbox">
        <label for="ctlFracDensity">Fracture density</label><input id="ctlFracDensity" type="range" min="0" max="1" step="0.01" value="0.35">
        <label for="ctlFracThick">Fracture thickness</label><input id="ctlFracThick" type="range" min="0.5" max="4" step="0.1" value="1.2">
        <label for="ctlFracAlpha">Fracture opacity</label><input id="ctlFracAlpha" type="range" min="0" max="1" step="0.01" value="0.5">

        <label for="ctlVGOn">Vanishing guides</label><input id="ctlVGOn" type="checkbox">
        <label for="ctlVGTilt">Horizon tilt</label><input id="ctlVGTilt" type="range" min="-45" max="45" step="1" value="0">
        <label for="ctlVGDensity">Guide density</label><input id="ctlVGDensity" type="range" min="0.1" max="2" step="0.05" value="0.6">
        <label for="ctlVGTwo">Two vanishing points</label><input id="ctlVGTwo" type="checkbox">

        <label for="ctlMarksOn">Control marks</label><input id="ctlMarksOn" type="checkbox">
        <label for="ctlMarksDensity">Marks density</label><input id="ctlMarksDensity" type="range" min="0" max="1" step="0.01" value="0.3">
        <label for="ctlMarksSize">Marks size</label><input id="ctlMarksSize" type="range" min="1" max="6" step="1" value="2">
        <label for="ctlMarksAlpha">Marks opacity</label><input id="ctlMarksAlpha" type="range" min="0" max="1" step="0.01" value="0.8">
      </div>

      <hr>

      <!-- Discipline pack -->
      <h3>Discipline <button id="resetDisc" class="tinybtn" title="Reset discipline">Reset</button></h3>
      <div class="grid">
        <label for="ctlDiscSelect">Pack</label>
        <select id="ctlDiscSelect">
          <option value="none">None</option>
          <option value="v3">Rectilinear Discipline v3</option>
        </select>
      </div>

      <div id="secDiscipline" class="grid hidden">
        <label for="ctlDiscSym">Symmetry strength</label><input id="ctlDiscSym" type="range" min="0" max="1" step="0.01" value="0.3">
        <label for="ctlDiscCorner">Right-angle force</label><input id="ctlDiscCorner" type="range" min="0" max="1" step="0.01" value="0.7">
        <label for="ctlDiscStraight">Straighten runs</label><input id="ctlDiscStraight" type="range" min="0" max="1" step="0.01" value="0.6">
        <label for="ctlDiscOutline">Outline unify</label><input id="ctlDiscOutline" type="range" min="0" max="2" step="0.1" value="1.0">
      </div>

      <hr>

      <!-- Transformations: Mockery & Confession -->
      <h3>Transformations <button id="resetTrans" class="tinybtn" title="Reset transformations">Reset</button></h3>
      <div class="grid">
        <label for="ctlTransSelect">Mode</label>
        <select id="ctlTransSelect">
          <option value="none">None</option>
          <option value="mockery">Architect's Mockery</option>
          <option value="confession">Machine's Confession</option>
        </select>
      </div>

      <div id="secMockery" class="grid hidden">
        <label for="ctlMockExag">Exaggeration</label><input id="ctlMockExag" type="range" min="0" max="1" step="0.01" value="0.4">
        <label for="ctlMockErase">Erasure %</label><input id="ctlMockErase" type="range" min="0" max="1" step="0.01" value="0.15">
        <label for="ctlMockDetail">Over-detail</label><input id="ctlMockDetail" type="range" min="0" max="1" step="0.01" value="0.3">
      </div>

      <div id="secConfession" class="grid hidden">
        <label for="ctlConfRigid">Rigidity</label><input id="ctlConfRigid" type="range" min="0" max="1" step="0.01" value="0.6">
        <label for="ctlConfSymbols">Symbol density</label><input id="ctlConfSymbols" type="range" min="0" max="1" step="0.01" value="0.25">
        <label for="ctlConfGhost">Ghost lines</label><input id="ctlConfGhost" type="range" min="0" max="1" step="0.01" value="0.35">
        <label for="ctlConfScour">Scour opacity</label><input id="ctlConfScour" type="range" min="0" max="1" step="0.01" value="0.15">
      </div>

      <hr>
      <div class="hint">Movement: WASD / Arrows • Panel scrolls independently • View pinned top-left</div>
      <div style="height:6px"></div>
    </div>
  </div>

  <script src="https://unpkg.com/pixi.js@7/dist/pixi.min.js"></script>
  <script type="module" src="main.js"></script>
</body>
</html>
