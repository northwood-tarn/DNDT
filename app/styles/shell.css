:root {
  --bg: #0b0f14;
  --panel: #111823;
  --panel-2: #0e1520;
  --acc: #9bb7ff; /* blue used for headings */
  --text: #e6e6e6;
  --muted: #9aa9c7;
  --mono: ui-monospace, Menlo, Monaco, Consolas, "Courier New", monospace;

  /* === Dialogue typography tokens (LOCKED SPEC) === */
  --font-ui: "Myriad Pro", "Myriad", "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
  --font-prose: "Baskerville", "Baskerville Old Face", "Garamond", "Times New Roman", serif;
  --font-speaker: "Avenir Light", "Avenir", "Helvetica Neue", Helvetica, Arial, sans-serif;

  /* Sizes (pt â†’ px): 30ptâ‰ˆ40px, 20ptâ‰ˆ27px, 16ptâ‰ˆ21px, 15ptâ‰ˆ20px, 12ptâ‰ˆ16px */
  --dlg-location-size: 40px;
  --dlg-prose-size: 27px;
  --dlg-speaker-size: 21px;
  --dlg-choice-size: 20px;
  --dlg-tag-size: 16px;

  --dlg-location-color: rgba(255, 255, 255, 0.10);
  --dlg-prose-color: rgba(120, 123, 123, 0.90); /* #787b7b @ 90% */
  --dlg-speaker-color: rgba(255, 255, 255, 0.30);

  --dlg-skill-color: #634a72;
  --dlg-class-color: #845b02;

  --dlg-prose-tracking: 0.02em;

  /* Skill-check icon (end-of-line marker) */
  --dlg-check-icon-content: "âš„"; /* Unicode die face (fallback). Swap to "âš…" or "ðŸŽ²" if you prefer */
  --dlg-check-icon-size: 16px;
  --dlg-check-icon-color: rgba(255, 255, 255, 0.35);
  --dlg-check-icon-gap: 10px;
}
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; background-color: var(--bg); color: var(--text); }
.app-grid {
  display: grid;
  grid-template-rows: 36px 1fr 140px;
  grid-template-columns: 320px 1fr 320px;
  grid-template-areas:
    "top top top"
    "left center right"
    "bottom bottom bottom";
  gap: 8px;
  padding: 8px;
  height: 100%;
}
.top { grid-area: top; background: var(--panel); border: 1px solid #2d3b5e; display:flex; align-items:center; padding: 0 10px; font: 12px/1 var(--mono); letter-spacing: .5px; color: #9aa9c7; }
.left { grid-area: left; background: var(--panel-2); border: 1px solid #22314d; padding: 8px; overflow:auto;}
.center {
  grid-area: center;
  background: transparent;
  border: 1px solid #22314d;
  padding: 8px;
  overflow: auto;
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
}
.right { grid-area: right; background: var(--panel-2); border: 1px solid #22314d; padding: 8px; overflow:auto; display:flex; align-items:flex-start; justify-content:flex-start; text-align:left; }
.bottom {
  grid-area: bottom;
  background: transparent;
  border: 1px solid #22314d;
  padding: 6px;
  overflow: auto;
}
.log { font: 12px/1.35 var(--mono); white-space: pre-wrap; }
#asciiMap { margin:0; font: 14px/1.05 var(--mono); color: #cfd8e6; }
button { background:#162234; color: #e6e6e6; border:1px solid #2d3b5e; padding:6px 10px; border-radius:6px; cursor:pointer; }
button:hover { background:#1b2a42; }
.btn-narrow { width: 220px; }
input, select { background:#101826; color:#e6e6e6; border:1px solid #22314d; padding:6px; border-radius:6px; }
hr { border: none; border-top: 1px solid #22314d; margin: 10px 0; }

/* Title screen */
.title-wrap { width: 100%; display:flex; flex-direction:column; align-items:center; gap: 8px; }
.title-sunburst { width: min(70%, 720px); image-rendering: pixelated; opacity: 0; animation: fadeInSun 5s ease forwards; }
@keyframes fadeInSun { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
.title-hero { font-family: var(--mono); letter-spacing: .18em; font-size: 24px; font-weight: 700; text-align: center; color: var(--text); }
.title-tagline { font-family: var(--mono); letter-spacing: .28em; font-size: 18px; font-weight: 700; text-align: center; color: #2d3b5e; }

/* Enforce shell font in the left pane (debug/metadata), but not globally in center/right */
.left * { font-family: var(--mono) !important; }

/* Section title (blue, caps) reused in right pane for ABILITIES / SKILLS */
.section-title { font: 11px/1 var(--mono); letter-spacing: 1px; text-transform: uppercase; color: var(--acc); }

/* Compact confirm buttons so they never overflow */
.btn-confirm { padding: 2px 8px; line-height: 1.1; font-size: 12px; white-space: nowrap; max-width: 84px; }

/* Smaller skills text in the right pane to avoid crowding */
.skills-list { font-size: 12px; }

/* â€¦ keep your existing rules â€¦ */

/* Ensure the UI everywhere uses the shell mono */
.left * { font-family: var(--mono) !important; }

/* Blue/caps headings reused across panes */
.section-title {
  font: 11px var(--mono);
  letter-spacing: 1px;
  text-transform: uppercase;
  color: #9aa9c7;
}

/* small helpers used by CharacterSelect */
.muted { color: #9aa9c7; }
.mono  { font: 12px/1.35 var(--mono); }

.btn-confirm { padding: 2px 8px; line-height: 1.1; font-size: 12px; white-space: nowrap; max-width: 84px; }

/* === Map sizing driven by CSS variables (prevents wrap & double walls) === */
#asciiMap.dom-map {
  /* enforce the custom font for glyph cells */
  font-family: 'GameGlyphs', var(--mono) !important;
  /* dynamic viewport size: rows/cols come from scene */
  --cols: 40;
  --rows: 18;
  --cell-w: 16px;
  --cell-h: 18px;
  inline-size: calc(var(--cols) * var(--cell-w));
  block-size: calc(var(--rows) * var(--cell-h));
}

#asciiMap.dom-map .row { height: var(--cell-h); line-height: var(--cell-h); white-space: nowrap; }
#asciiMap.dom-map .cell { display: inline-block; width: var(--cell-w); height: var(--cell-h); line-height: var(--cell-h); text-align: center; user-select: none; }

/* Lighting purely by background; dark stays transparent to prevent trails */
#asciiMap.dom-map .cell.lit  { background-color: rgba(255,255,255,0.06); }
#asciiMap.dom-map .cell.dim  { background-color: rgba(255,255,255,0.035); }
#asciiMap.dom-map .cell.dark { background-color: transparent; }

/* Ensure PC/border fall back to the glyph font even if other rules interfere */
#asciiMap.dom-map .cell.pc,
#asciiMap.dom-map .cell.border { font-family: 'GameGlyphs', var(--mono) !important; }

/* ensured dom-map rules */

/* === Map sizing via variables; force glyph font === */
#asciiMap.dom-map{
  font-family: 'GameGlyphs', var(--mono) !important;
  --cell-w: 16px;
  --cell-h: 18px;
  inline-size: calc(var(--cols, 40) * var(--cell-w));
  block-size: calc(var(--rows, 18) * var(--cell-h));
  white-space: normal;
}
#asciiMap.dom-map .row{ height: var(--cell-h); line-height: var(--cell-h); white-space: nowrap; }
#asciiMap.dom-map .cell{
  display:inline-block; width:var(--cell-w); height:var(--cell-h);
  line-height:var(--cell-h); text-align:center; user-select:none;
}
#asciiMap.dom-map .cell.lit  { background-color: rgba(255,255,255,0.06); }
#asciiMap.dom-map .cell.dim  { background-color: rgba(255,255,255,0.035); }
#asciiMap.dom-map .cell.dark { background-color: transparent; }

/* === GameGlyphs font face + hard mapping onto DOM map (surgical override) === */
@font-face {
  font-family: 'GameGlyphs';
  src: url('../assets/fonts/fontello_min.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

/* Force custom font on the map host and its cells to beat pane-wide monospace */
#asciiMap.dom-map,
#asciiMap.dom-map .cell {
  font-family: 'GameGlyphs', var(--mono) !important;
}

.drag-region {
  position: fixed;
  top: 0;
  left: 0;
  height: 40px;
  width: 100%;
  -webkit-app-region: drag;
  z-index: 9999;
  background: transparent; /* invisible but still draggable */
}

/* Ensure the drag region sits above Pixi canvas (requires placement after canvas in HTML) */
.drag-region {
  z-index: 9999 !important;
}

/*
  To ensure proper layering, index.html must include the following structure:

  <div id="game-root"></div>
  <div class="drag-region"></div>

  The drag-region div must be placed after the game-root div (which hosts the Pixi canvas)
  so that the drag region appears above the Pixi canvas layers.
*/

:fullscreen .drag-region,
:-webkit-full-screen .drag-region {
  display: none;
  -webkit-app-region: no-drag;
}

button, a, input, textarea {
  -webkit-app-region: no-drag;
}

#game-root {
  position: absolute;
  inset: 0;
}

body:not(.shell-mode) .app-grid {
  display: none;
}

/* === PIXI canvas layering (engine background) === */
#pixi-root {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none; /* background only */
}

#pixi-root canvas {
  display: block;
}

/* === DOM UI sits above PIXI === */
#game-root {
  position: absolute;
  inset: 0;
  z-index: 10;
  background: transparent;
}

/* === Dialogue semantic styling (uses tokens above) === */

/* Location header: Â· LOCATION Â· */
.dialogue-location {
  font-family: var(--font-ui);
  font-size: var(--dlg-location-size);
  font-weight: 400;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--dlg-location-color);
  text-align: center;
  margin: 0 0 10px 0;
}
.dialogue-location::before { content: "Â· "; }
.dialogue-location::after  { content: " Â·"; }

/* Prose line */
.dialogue-prose {
  font-family: var(--font-prose);
  font-size: var(--dlg-prose-size);
  font-style: italic;
  letter-spacing: var(--dlg-prose-tracking);
  color: var(--dlg-prose-color);
  margin: 0 0 22px 0;
}

/* Speaker name */
.dialogue-speaker,
.dialogue-name {
  font-family: var(--font-speaker);
  font-size: var(--dlg-speaker-size);
  font-weight: 300;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--dlg-speaker-color);
  margin: 0 0 10px 0;
}

/* Choice list */
.dialogue-choices { margin: 0; padding: 0; }

.dialogue-choice {
  font-family: var(--font-prose);
  font-size: var(--dlg-choice-size);
  font-style: normal;
  color: var(--text);
  margin: 0 0 22px 0; /* vertical rhythm */
}
.dialogue-choice.is-desc { font-style: italic; }

/* Skill-check marker: add class `has-check` on the choice line */
.dialogue-choice.has-check::after {
  content: var(--dlg-check-icon-content);
  display: inline-block;
  margin-left: var(--dlg-check-icon-gap);
  font-family: var(--font-ui);
  font-size: var(--dlg-check-icon-size);
  line-height: 1;
  color: var(--dlg-check-icon-color);
  vertical-align: baseline;
}

/* The number + dot prefix (e.g., "2 Â·") */
.dialogue-choice .choice-num {
  display: inline-block;
  min-width: 1.4em;
  font-variant-numeric: tabular-nums;
}
.dialogue-choice .choice-dot { padding: 0 10px 0 6px; }

/* Skill / class tags */
.dialogue-tag-skill,
.dialogue-skill {
  font-family: var(--font-ui);
  font-size: var(--dlg-tag-size);
  font-weight: 400;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--dlg-skill-color);
}

.dialogue-tag-class,
.dialogue-class {
  font-family: var(--font-ui);
  font-size: var(--dlg-tag-size);
  font-weight: 400;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--dlg-class-color);
}